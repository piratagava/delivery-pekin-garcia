"use strict";(self.webpackChunkdelivery_pekin_garcia=self.webpackChunkdelivery_pekin_garcia||[]).push([[248],{3248:(A,C,s)=>{s.r(C),s.d(C,{CompraFinalModule:()=>N});var g=s(177),v=s(9032),f=s(467),r=s(4341),k=s(8032),F=s.n(k),e=s(540),_=s(5794),j=s(6145),R=s(1530);let S=(()=>{class i{constructor(n){this._compraFinalGateway=n}getResponseGuardaCompraFinal(n){var o=this;return(0,f.A)(function*(){try{return o._compraFinalGateway.saveCompraFinal(n)}catch(t){throw t}})()}static{this.\u0275fac=function(o){return new(o||i)(e.KVO(R.p))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var y=s(1869);function P(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2," El nombre es requerido "),e.k0s()())}function M(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2," Limite su nombre porfavor "),e.k0s()())}function w(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2," Solo se permiten letras y espacios"),e.k0s()())}function I(i,c){if(1&i&&(e.j41(0,"div",47),e.DNE(1,P,3,0,"div",48),e.DNE(2,M,3,0,"div",48),e.DNE(3,w,3,0,"div",48),e.k0s()),2&i){const n=e.XpG();e.R7$(1),e.Y8G("ngIf",null==n.nombreCliente||null==n.nombreCliente.errors?null:n.nombreCliente.errors.required),e.R7$(1),e.Y8G("ngIf",null==n.nombreCliente||null==n.nombreCliente.errors?null:n.nombreCliente.errors.maxlength),e.R7$(1),e.Y8G("ngIf",null==n.nombreCliente||null==n.nombreCliente.errors?null:n.nombreCliente.errors.pattern)}}function z(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2,"La localidad es requerida"),e.k0s()())}function $(i,c){if(1&i&&(e.j41(0,"div",47),e.DNE(1,z,3,0,"div",48),e.k0s()),2&i){const n=e.XpG();e.R7$(1),e.Y8G("ngIf",null==n.localidad||null==n.localidad.errors?null:n.localidad.errors.required)}}function O(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2," Describe el lugar donde se te entregara tu pedido"),e.k0s()())}function x(i,c){1&i&&(e.j41(0,"div")(1,"span",49),e.EFF(2,"Solo se permiten letras, n\xfameros y espacios"),e.k0s()())}function G(i,c){if(1&i&&(e.j41(0,"div",47),e.DNE(1,O,3,0,"div",48),e.DNE(2,x,3,0,"div",48),e.k0s()),2&i){const n=e.XpG();e.R7$(1),e.Y8G("ngIf",null==n.descripcionEntrega||null==n.descripcionEntrega.errors?null:n.descripcionEntrega.errors.required),e.R7$(1),e.Y8G("ngIf",null==n.descripcionEntrega||null==n.descripcionEntrega.errors?null:n.descripcionEntrega.errors.pattern)}}function L(i,c){if(1&i&&(e.j41(0,"div",50),e.nrm(1,"img",51),e.k0s()),2&i){const n=e.XpG();e.R7$(1),e.Y8G("src",n.imagenPrevia,e.B4B)}}function U(i,c){if(1&i&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.nI1(5,"currency"),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s(),e.j41(8,"td"),e.EFF(9),e.nI1(10,"currency"),e.k0s()()),2&i){const n=c.$implicit;e.R7$(2),e.JRh(n.nombreProducto),e.R7$(2),e.SpI(" ",e.ii3(5,4,n.precio,"MXN","$","1.2-2")," "),e.R7$(3),e.JRh(n.cantidad),e.R7$(2),e.SpI(" ",e.ii3(10,9,n.precioxCantidad,"MXN","$","1.2-2")," ")}}const b=function(i){return{"is-invalid":i}},D=[{path:"final",component:(()=>{class i{constructor(n,o,t,a,l,m){this.fb=n,this.toastr=o,this.cdRef=t,this.uuidStorageService=a,this._compraFinalUseCase=l,this.router=m,this.imagenPrevia=null,this.imagenArchivo=null,this.imagenBase64=null,this.currentFileReader=null,this.recibeSubtotalMenuSeleccionado=0,this.total=0,this.costoEnvio=0,this.selectedLocalidad="",this.pedidoForm=this.fb.group({nombreCliente:["",[r.k0.required,r.k0.maxLength(80),r.k0.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\xfc\xdc\s]+$/)]],localidad:["",r.k0.required],descripcionEntrega:["",[r.k0.required,r.k0.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\xfc\xdc0-9\s]+$/)]]});const h=this.router.getCurrentNavigation();h?.extras.state&&(this.ordenPrincipal=h.extras.state.itemCompraFinal,console.log("Orden principal:",this.ordenPrincipal))}ngOnInit(){this.recibeSubtotalMenuSeleccionado=(this.ordenPrincipal.products??[]).reduce((n,o)=>n+o.precioxCantidad,0)}onSubmit(){var n=this;return(0,f.A)(function*(){if(n.pedidoForm.valid&&null!==n.imagenBase64){const o={...n.pedidoForm.value,productosPedidos:n.ordenPrincipal.products,imagenEntrega:n.imagenBase64,totalMasEnvio:n.total,subtotal:n.recibeSubtotalMenuSeleccionado,sessionUserWeb:n.uuidStorageService.getOrCreateUserUuid(),estatus:"10",instruccionesEspeciales:"NO APLICA",campoExtra1:"NO APLICA"};console.log("Datos del formulario:",o);try{const t=yield n._compraFinalUseCase.getResponseGuardaCompraFinal(o),{statusCodeEjecuteProcedure:a,message:l}=t;n.onCancel(200===a?2:3,l)}catch{n.toastr.error("Error al procesar la solicitud")}}else n.toastr.warning("Favor de capturar una foto"),console.log("Formulario inv\xe1lido o imagen no seleccionada")})()}calcularTotales(){"Potzontepec"===this.selectedLocalidad?(this.costoEnvio=10,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio):"San Miguelito"===this.selectedLocalidad?(this.costoEnvio=20,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio):"El Calvarito"===this.selectedLocalidad?(this.costoEnvio=30,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio):"El Ranchito"===this.selectedLocalidad?(this.costoEnvio=40,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio):"Mextepec"===this.selectedLocalidad?(this.costoEnvio=50,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio):"San Francisco de Asis"===this.selectedLocalidad&&(this.costoEnvio=60,this.total=this.recibeSubtotalMenuSeleccionado+this.costoEnvio),console.log("costo + envio:",this.total)}onLocalidadChange(n){this.selectedLocalidad=n.target.value,console.log("Localidad seleccionada:",this.selectedLocalidad),this.calcularTotales()}onFileSelected(n){var o=this;return(0,f.A)(function*(){const t=n.target,a=t.files?.[0];if(a){if(o.cleanupPreviousResources(),a.size>20971520)return o.toastr.warning("La imagen supera el tama\xf1o m\xe1ximo de 20MB"),void o.resetFileInput(t);try{const l=yield o.compressImage(a);o.imagenArchivo=l,o.currentFileReader=new FileReader,o.currentFileReader.onload=()=>{o.imagenPrevia=o.currentFileReader?.result,o.imagenBase64=o.imagenPrevia.split(",")[1]},o.currentFileReader.readAsDataURL(l)}catch(l){console.error("Error procesando imagen:",l),o.toastr.error("Error al procesar la imagen"),o.resetFileInput(t)}}})()}compressImage(n){return(0,f.A)(function*(){return new Promise((o,t)=>{const a=new Image,l=URL.createObjectURL(n);a.onload=()=>{const m=document.createElement("canvas"),h=m.getContext("2d"),p=800;let d=a.width,u=a.height;d>u?d>p&&(u*=p/d,d=p):u>p&&(d*=p/u,u=p),m.width=d,m.height=u,h?.drawImage(a,0,0,d,u),m.toBlob(E=>{E?(o(new File([E],n.name,{type:"image/jpeg",lastModified:Date.now()})),URL.revokeObjectURL(l)):t(new Error("Error al comprimir imagen"))},"image/jpeg",.7)},a.onerror=()=>{URL.revokeObjectURL(l),t(new Error("Error al cargar imagen"))},a.src=l})})()}cleanupPreviousResources(){this.currentFileReader&&this.currentFileReader.abort(),this.imagenPrevia&&"string"==typeof this.imagenPrevia&&URL.revokeObjectURL(this.imagenPrevia)}resetFileInput(n){n.value="",this.imagenPrevia=null,this.imagenArchivo=null,this.imagenBase64=null}onCancel(n,o){this.pedidoForm.reset(),this.imagenPrevia=null,this.imagenArchivo=null,this.imagenBase64=null,this.router.navigate(["/index/restaurante-pekin"]),this.uuidStorageService.clearUserUuid(),1==n?F().fire({title:"Proceso Cancelado",text:o||"Se han limpiado los datos y se ha cancelado la operaci\xf3n.",icon:"error",showConfirmButton:!1,timer:7500,timerProgressBar:!0,showClass:{popup:"animate__animated animate__shakeX"},hideClass:{popup:"animate__animated animate__fadeOutDown"},background:"#fff5f5",color:"#c0392b",iconColor:"#e74c3c"}):2==n?F().fire({title:"\xa1Disfruta tu pedido!",text:o||"Su pedido se realiz\xf3 exitosamente",icon:"success",showConfirmButton:!1,timer:8e3,timerProgressBar:!0,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"},background:"#ffffff",color:"#2d3436",iconColor:"#28a745"}):3==n&&F().fire({title:"\xa1Ups!",text:o||"Se han limpiado los datos y se ha cancelado la operaci\xf3n.",icon:"error",showConfirmButton:!1,timer:7500,timerProgressBar:!0,showClass:{popup:"animate__animated animate__shakeX"},hideClass:{popup:"animate__animated animate__fadeOutDown"},background:"#fff5f5",color:"#c0392b",iconColor:"#e74c3c"})}get nombreCliente(){return this.pedidoForm.get("nombreCliente")}get localidad(){return this.pedidoForm.get("localidad")}get descripcionEntrega(){return this.pedidoForm.get("descripcionEntrega")}static{this.\u0275fac=function(o){return new(o||i)(e.rXU(r.ok),e.rXU(_.tw),e.rXU(e.gRc),e.rXU(j.M),e.rXU(S),e.rXU(v.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-finalizar-compra"]],decls:92,vars:34,consts:[[1,"container","mt-5"],[1,"row","justify-content-center"],[1,"col-md-8","col-lg-7"],[1,"card","shadow"],[1,"card-header","bg-gradient-orange-red","text-white"],[1,"mb-0","text-center"],[1,"card-body"],["novalidate","",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","nombre",1,"form-label"],["type","text","id","nombreCliente","formControlName","nombreCliente","placeholder","Quien realiza el pedido ?",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","localidad",1,"form-label"],["id","localidad","formControlName","localidad",1,"form-select",3,"ngClass","change"],["value","","disabled","","selected",""],["value","Potzontepec"],["value","San Miguelito"],["value","Mextepec"],["value","El Calvarito"],["value","El Ranchito"],["value","San Francisco de Asis"],["for","descripcion",1,"form-label"],["id","descripcionEntrega","rows","3","formControlName","descripcionEntrega","placeholder","Describe alguna referencia de entrega ejemplo (frente a la cancha comunitaria)",1,"form-control",3,"ngClass"],[1,"mb-4"],[1,"capture-label"],[1,"d-flex","flex-column","flex-md-row","align-items-start","gap-3"],[1,"custom-file-upload"],["for","imagen",1,"btn","btn-primary","d-flex","align-items-center","gap-2"],[1,"bi","bi-camera"],["type","file","id","imagen","accept","image/*","capture","camera",1,"d-none",3,"change"],["class","flex-grow-1 text-center text-md-start",4,"ngIf"],[1,"mb-3","p-3","border","rounded",2,"background-color","#f8f9fa"],[1,"text-center","mb-3",2,"color","#ff2d55"],[1,"table-responsive","mb-3"],[1,"table","table-striped","table-hover","align-middle","text-center"],[1,"table-danger"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mb-2"],[2,"font-size","18px","font-weight","500"],[2,"font-size","18px"],[2,"border-top","2px dashed #ff2d55"],[1,"d-flex","justify-content-between","mt-3"],[2,"font-size","20px","font-weight","600","color","#ff2d55"],[1,"text-center","mt-3"],[1,"d-grid","gap-2","d-md-flex","justify-content-md-end"],["type","button",1,"btn","btn-outline-secondary","me-md-2",3,"click"],["type","submit",1,"btn","btn-orange-red",3,"disabled"],[1,"invalid-feedback"],[4,"ngIf"],[2,"font-size","16px"],[1,"flex-grow-1","text-center","text-md-start"],[1,"img-thumbnail",2,"max-height","145px","max-width","130%",3,"src"]],template:function(o,t){1&o&&(e.nrm(0,"app-encabezado-pekin"),e.j41(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h3",5),e.EFF(7,"Finaliza tu pedido"),e.k0s()(),e.j41(8,"div",6)(9,"form",7),e.bIt("ngSubmit",function(){return t.onSubmit()}),e.j41(10,"div",8)(11,"label",9),e.EFF(12,"A nombre de:"),e.k0s(),e.nrm(13,"input",10),e.DNE(14,I,4,3,"div",11),e.k0s(),e.j41(15,"div",8)(16,"label",12),e.EFF(17,"Localidad de entrega:"),e.k0s(),e.j41(18,"select",13),e.bIt("change",function(l){return t.onLocalidadChange(l)}),e.j41(19,"option",14),e.EFF(20," Seleccione una localidad "),e.k0s(),e.j41(21,"option",15),e.EFF(22,"Potzontepec"),e.k0s(),e.j41(23,"option",16),e.EFF(24,"San Miguelito"),e.k0s(),e.j41(25,"option",17),e.EFF(26,"Mextepec"),e.k0s(),e.j41(27,"option",18),e.EFF(28,"El Calvarito"),e.k0s(),e.j41(29,"option",19),e.EFF(30,"El Ranchito"),e.k0s(),e.j41(31,"option",20),e.EFF(32,"San Francisco de Asis"),e.k0s()(),e.DNE(33,$,2,1,"div",11),e.k0s(),e.j41(34,"div",8)(35,"label",21),e.EFF(36,"Lugar de entrega:"),e.k0s(),e.nrm(37,"textarea",22),e.DNE(38,G,3,2,"div",11),e.k0s(),e.j41(39,"div",23)(40,"label",24),e.EFF(41," Captura una foto de referencia para tu entrega: "),e.k0s(),e.j41(42,"div",25)(43,"div",26)(44,"label",27),e.nrm(45,"i",28),e.j41(46,"span"),e.EFF(47,"Tomar foto"),e.k0s()(),e.j41(48,"input",29),e.bIt("change",function(l){return t.onFileSelected(l)}),e.k0s()(),e.DNE(49,L,2,1,"div",30),e.k0s()(),e.j41(50,"div",31)(51,"h4",32),e.EFF(52," Detalle de tu pedido "),e.k0s(),e.j41(53,"div",33)(54,"table",34)(55,"thead",35)(56,"tr")(57,"th"),e.EFF(58,"Orden"),e.k0s(),e.j41(59,"th"),e.EFF(60,"Precio Unitario"),e.k0s(),e.j41(61,"th"),e.EFF(62,"Cantidad"),e.k0s(),e.j41(63,"th"),e.EFF(64,"Subtotal"),e.k0s()()(),e.j41(65,"tbody"),e.DNE(66,U,11,14,"tr",36),e.k0s()()(),e.j41(67,"div",37)(68,"span",38),e.EFF(69,"Subtotal del pedido:"),e.k0s(),e.j41(70,"span",39),e.EFF(71),e.nI1(72,"currency"),e.k0s()(),e.j41(73,"div",37)(74,"span",38),e.EFF(75,"Env\xedo a domicilio:"),e.k0s(),e.j41(76,"span",39),e.EFF(77),e.nI1(78,"currency"),e.k0s()(),e.nrm(79,"hr",40),e.j41(80,"div",41)(81,"span",42),e.EFF(82,"Total a pagar:"),e.k0s(),e.j41(83,"span",42),e.EFF(84),e.nI1(85,"currency"),e.k0s()(),e.nrm(86,"div",43),e.k0s(),e.j41(87,"div",44)(88,"button",45),e.bIt("click",function(){return t.onCancel(1,"Compra cancelada correctamente")}),e.EFF(89," Cancelar "),e.k0s(),e.j41(90,"button",46),e.EFF(91," Enviar "),e.k0s()()()()()()()()),2&o&&(e.R7$(9),e.Y8G("formGroup",t.pedidoForm),e.R7$(4),e.Y8G("ngClass",e.eq3(28,b,(null==t.nombreCliente?null:t.nombreCliente.touched)&&(null==t.nombreCliente?null:t.nombreCliente.invalid))),e.R7$(1),e.Y8G("ngIf",(null==t.nombreCliente?null:t.nombreCliente.touched)&&(null==t.nombreCliente?null:t.nombreCliente.invalid)),e.R7$(4),e.Y8G("ngClass",e.eq3(30,b,(null==t.localidad?null:t.localidad.touched)&&(null==t.localidad?null:t.localidad.invalid))),e.R7$(15),e.Y8G("ngIf",(null==t.localidad?null:t.localidad.touched)&&(null==t.localidad?null:t.localidad.invalid)),e.R7$(4),e.Y8G("ngClass",e.eq3(32,b,(null==t.descripcionEntrega?null:t.descripcionEntrega.touched)&&(null==t.descripcionEntrega?null:t.descripcionEntrega.invalid))),e.R7$(1),e.Y8G("ngIf",(null==t.descripcionEntrega?null:t.descripcionEntrega.touched)&&(null==t.descripcionEntrega?null:t.descripcionEntrega.invalid)),e.R7$(11),e.Y8G("ngIf",t.imagenPrevia),e.R7$(17),e.Y8G("ngForOf",null==t.ordenPrincipal?null:t.ordenPrincipal.products),e.R7$(5),e.JRh(e.ii3(72,13,t.recibeSubtotalMenuSeleccionado,"MXN","$","1.2-2")),e.R7$(6),e.JRh(e.ii3(78,18,t.costoEnvio,"MXN","$","1.2-2")),e.R7$(7),e.SpI(" ",e.ii3(85,23,t.recibeSubtotalMenuSeleccionado+t.costoEnvio,"MXN","$","1.2-2")," "),e.R7$(6),e.Y8G("disabled",t.pedidoForm.invalid))},dependencies:[g.YU,g.Sq,g.bT,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.j4,r.JD,y.f,g.oe],styles:['.btn-orange-red[_ngcontent-%COMP%]{background:linear-gradient(135deg,#FF6B35,#EF3E36);color:#fff;border:none}.btn-orange-red[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#e05f2a,#d13730);color:#fff}.btn-orange-red[_ngcontent-%COMP%]:disabled{background:linear-gradient(135deg,#ffb08a,#f58a85);cursor:not-allowed}.bg-gradient-orange-red[_ngcontent-%COMP%]{background:linear-gradient(135deg,#FF6B35,#EF3E36)}.custom-file-upload[_ngcontent-%COMP%]{position:relative;overflow:hidden;display:inline-block}.custom-file-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;left:0;top:0;opacity:0;width:100%;height:100%;cursor:pointer}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0b5ed7;border-color:#0a58ca}@media (max-width: 767.98px){.custom-file-upload[_ngcontent-%COMP%]{width:100%}.custom-file-upload[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%;justify-content:center}}.capture-label[_ngcontent-%COMP%]{display:block;font-size:.8rem;font-weight:700;color:#ff6b00;text-shadow:0 2px 4px rgba(0,0,0,.2);margin-bottom:1rem;position:relative;padding-left:1.8rem;animation:_ngcontent-%COMP%_pulse 2s infinite alternate}.capture-label[_ngcontent-%COMP%]:before{content:"\\1f4f8";position:absolute;left:0;transform:rotate(-5deg);animation:_ngcontent-%COMP%_shake 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}to{transform:scale(1.02);color:#ff3d00}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:rotate(-5deg) scale(1.2)}25%{transform:rotate(5deg) scale(1.3)}50%{transform:rotate(-5deg) scale(1.2)}75%{transform:rotate(5deg) scale(1.3)}}']})}}return i})()}];let T=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[v.iI.forChild(D),v.iI]})}}return i})(),N=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[g.MD,r.X1,T]})}}return i})()}}]);